<div class="pokemon-container">
  <!-- Header -->
  <div class="header">
    <h1>Pok√©mon</h1>
    <p class="subtitle">Selecciona 3 Pok√©mon para que sean parte de tu equipo</p>
  </div>

  <!-- Search Bar -->
  <div class="search-box">
    <input
      type="text"
      class="search-input"
      placeholder="üîç Buscar por √≠ndice, nombre..."
      [(ngModel)]="searchTerm"
      (input)="onSearchChange()"
    />
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-state">
      <div class="pokeball-loader"></div>
      <p>Cargando Pok√©mon...</p>
    </div>
  }

  <!-- Error State -->
  @if (errorMessage) {
    <div class="error-state">
      <p>‚ö†Ô∏è {{ errorMessage }}</p>
      <button class="retry-btn" (click)="loadPokemon()">Reintentar</button>
    </div>
  }

  <!-- Pokemon Grid with Virtual Scroll (3x3) -->
  @if (!isLoading && !errorMessage) {
    <div class="pokemon-grid">
      <cdk-virtual-scroll-viewport
        [itemSize]="ITEM_SIZE"
        class="viewport"
      >
        @for (row of getPokemonRows(); track row[0]?.id) {
          <div class="pokemon-row">
            @for (pokemon of row; track pokemon.id) {
              <div
                class="pokemon-card"
                [class.selected]="isSelected(pokemon)"
                [class.disabled]="!canAddMore() && !isSelected(pokemon)"
                (click)="togglePokemon(pokemon)"
              >
                <div class="pokemon-image">
                  <img
                    [src]="pokemon.sprite"
                    [alt]="pokemon.name"
                    loading="lazy"
                  />
                </div>
                <div class="pokemon-badge">
                  <span class="pokemon-id">{{ getPokemonNumber(pokemon.id) }}</span>
                  <span class="pokemon-name">{{ pokemon.name }}</span>
                </div>
                @if (isSelected(pokemon)) {
                  <div class="checkmark">‚úì</div>
                }
              </div>
            }
          </div>
        }
      </cdk-virtual-scroll-viewport>
    </div>
  }

  <!-- No Results -->
  @if (!isLoading && filteredPokemon.length === 0) {
    <div class="no-results">
      <p>üòï No se encontraron Pok√©mon</p>
      <button class="clear-search-btn" (click)="searchTerm = ''; onSearchChange()">
        Limpiar b√∫squeda
      </button>
    </div>
  }

  <!-- Save Button -->
  @if (!isLoading) {
    <div class="save-section">
      <div class="team-counter">
        <span class="counter-text">{{ selectedTeam.length }}/{{ MAX_TEAM_SIZE }} Pok√©mon seleccionados</span>
        <div class="progress-bar">
          <div class="progress-fill" [style.width]="getProgressWidth()"></div>
        </div>
      </div>
      <button
        class="save-btn"
        [class.active]="selectedTeam.length === MAX_TEAM_SIZE"
        (click)="saveTeam()"
      >
        Guardar
      </button>
    </div>
  }
</div>
